<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>PV Suitability – Adana (V3)</title>

  <style>
    :root{
      --bg:#0b1220;
      --card:#0f1a2e;
      --card2:#101f36;
      --text:#e9eefc;
      --muted:#b8c2e0;
      --line:rgba(255,255,255,.10);
    }
    *{box-sizing:border-box}
    body{margin:0; font-family: Arial, sans-serif; background:var(--bg); color:var(--text);}
    .wrap{max-width:1200px; margin:0 auto; padding:22px;}
    h1{margin:0 0 8px 0; font-size:24px;}
    .sub{color:var(--muted); margin:0 0 18px 0; line-height:1.45;}
    .grid{display:grid; grid-template-columns:380px 1fr; gap:18px;}
    .panel{
      background:linear-gradient(180deg, var(--card) 0%, var(--card2) 100%);
      border:1px solid var(--line);
      border-radius:16px;
      padding:16px;
      box-shadow:0 10px 25px rgba(0,0,0,.25);
    }
    label{display:block; font-weight:800; margin:12px 0 6px;}
    select, input[type="range"]{width:100%;}
    select{
      padding:10px; border-radius:12px; border:1px solid var(--line);
      background:#0a1326; color:var(--text);
    }
    .row{display:flex; gap:10px; align-items:center;}
    .small{font-size:12px; color:var(--muted); line-height:1.45;}
    .btn{
      width:100%; margin-top:14px; padding:12px 14px;
      border-radius:12px; border:0; background:#ffffff; color:#0a0f1a;
      font-weight:900; cursor:pointer;
    }
    .kpis{display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:14px;}
    .kpi{
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      background:rgba(255,255,255,.03);
      min-height:72px;
    }
    .kpi .t{font-size:12px; color:var(--muted);}
    .kpi .v{font-size:18px; font-weight:900; margin-top:6px;}
    .kpi.full{grid-column:1 / span 2;}
    .hr{height:1px; background:var(--line); margin:14px 0;}
    .pill{
      display:inline-block; padding:4px 10px; border-radius:999px;
      border:1px solid var(--line); background:rgba(255,255,255,.04);
      font-size:12px; color:var(--muted);
    }

    .rightTop{display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap; align-items:flex-end;}
    .titleBlock h2{margin:0; font-size:16px;}
    .titleBlock .small{margin-top:6px;}
    .imgStack{display:flex; flex-direction:column; gap:14px; margin-top:12px;}
    .imgCard{
      border:1px solid var(--line);
      border-radius:16px;
      overflow:hidden;
      background:rgba(255,255,255,.03);
    }
    .imgHead{
      padding:12px 12px 10px 12px;
      border-bottom:1px solid var(--line);
      display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;
      align-items:center;
    }
    .imgHead .h{font-weight:900;}
    .imgHead .meta{font-size:12px; color:var(--muted);}
    .imgWrap{padding:12px;}
    img{
      width:100%;
      height:auto;
      display:block;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.08);
    }
    .legend{
      margin-top:10px;
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      background:rgba(255,255,255,.03);
    }
    .legendTitle{font-weight:900; font-size:13px; margin-bottom:8px;}
    .legRow{display:flex; align-items:center; gap:8px; margin:6px 0; font-size:12px; color:var(--muted);}
    .swatch{width:12px; height:12px; border-radius:3px; border:1px solid rgba(255,255,255,.25);}

    @media (max-width: 980px){
      .grid{grid-template-columns:1fr;}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <h1>PV Suitability & Energy Potential – Adana (Prototype)</h1>
    <p class="sub">
      Users explore PV scenarios by selecting PV technology, suitability class group, and coverage ratio.
      PR, building-demand proxy, and grid emission factor are fixed assumptions for clarity.
    </p>

    <div class="grid">
      <!-- LEFT -->
      <div class="panel">
        <div class="pill">Inputs</div>

        <label>1) PV Technology (module efficiency)</label>
        <select id="tech">
          <option value="0.131">c-Si (13.1%)</option>
          <option value="0.079">a-Si (7.9%)</option>
          <option value="0.088">CdTe (8.8%)</option>
          <option value="0.084">CIGS (8.4%)</option>
          <option value="0.263">CPV (26.3%)</option>
        </select>

        <label>2) Suitability class selection</label>
        <select id="classChoice">
          <option value="high">Highly suitable</option>
          <option value="mod">Moderately suitable</option>
          <option value="high+mod">Highly + Moderately suitable</option>
        </select>

        <label>3) Coverage ratio (how much of selected land is developed as PV)</label>
        <div class="row">
          <input id="coverage" type="range" min="0" max="30" value="10" />
          <div style="min-width:64px; text-align:right; font-weight:900;">
            <span id="covLabel">10</span>%
          </div>
        </div>
        <div class="small">
          Coverage is a scenario input. Slider capped at 30% to avoid unrealistic outcomes.
        </div>

        <button class="btn" onclick="calculate()">Calculate</button>

        <div class="hr"></div>
        <div class="pill">Results</div>

        <div class="kpis">
          <div class="kpi">
            <div class="t">Selected land area</div>
            <div class="v" id="k_area">—</div>
          </div>
          <div class="kpi">
            <div class="t">PV-developed area</div>
            <div class="v" id="k_used">—</div>
          </div>

          <div class="kpi">
            <div class="t">Solar radiation used (mean)</div>
            <div class="v" id="k_sr">—</div>
          </div>
          <div class="kpi">
            <div class="t">Annual generation</div>
            <div class="v" id="k_energy">—</div>
          </div>

          <div class="kpi">
            <div class="t">Buildings served (indicator)</div>
            <div class="v" id="k_build">—</div>
          </div>
          <div class="kpi">
            <div class="t">Avoided CO₂ (indicator)</div>
            <div class="v" id="k_co2">—</div>
          </div>

          <div class="kpi full">
            <div class="t">Assumptions (fixed)</div>
            <div class="small" id="assumptions"></div>
          </div>

          <div class="kpi full">
            <div class="t">Formula</div>
            <div class="small">
              Energy (kWh/year) = SR (kWh/m²/year) × Area(m²) × Coverage × Efficiency × PR
            </div>
          </div>
        </div>

        <div class="hr"></div>
        <div class="small">
          GIS sources: CLC2018, ASTER GDEM, ArcGIS Solar Radiation outputs. Academic prototype.
        </div>
      </div>

      <!-- RIGHT -->
      <div class="panel">
        <div class="rightTop">
          <div class="titleBlock">
            <h2>Maps (PNG overlays)</h2>
            <div class="small">Files are loaded directly from the GitHub repo root.</div>
          </div>
          <div class="small">
            Adana building count (reference): <b>73,992</b>
          </div>
        </div>

        <div class="imgStack">
          <div class="imgCard">
            <div class="imgHead">
              <div class="h">Final Suitability Map (Raster)</div>
              <div class="meta">File: suitability_son.png</div>
            </div>
            <div class="imgWrap">
              <img src="suitability_son.png" alt="Adana PV Suitability Raster"/>
              <div class="legend">
                <div class="legendTitle">Legend — PV Suitability Classes</div>
                <div class="small" style="margin-bottom:8px;">
                  Title: <b>PV Suitability (Adana)</b> · Unit: <b>categorical index</b>
                </div>
                <div class="legRow"><span class="swatch" style="background:#ffffff;"></span> NoData / Restricted</div>
                <div class="legRow"><span class="swatch" style="background:#00bcd4;"></span> Highly suitable</div>
                <div class="legRow"><span class="swatch" style="background:#2ecc71;"></span> Moderately suitable</div>
                <div class="legRow"><span class="swatch" style="background:#f1c40f;"></span> Low suitable (not used in calculations)</div>
                <div class="legRow"><span class="swatch" style="background:#e74c3c;"></span> Not suitable / Restricted</div>
              </div>
            </div>
          </div>

          <div class="imgCard">
            <div class="imgHead">
              <div class="h">Solar Radiation Map (Raster)</div>
              <div class="meta">File: radiation.png · Unit: kWh/m²/year</div>
            </div>
            <div class="imgWrap">
              <img src="radiation.png" alt="Adana Solar Radiation Raster"/>
              <div class="small" style="margin-top:10px;">
                Mean SR values used (by suitability zone):<br/>
                <b>Highly:</b> 1406.75546808 · <b>Moderately:</b> 1359.54816032
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

<script>
/**
 * ===== GIS INPUTS (UPDATE THESE TWO AREAS) =====
 * Units:
 * - Area: km²
 * - SR mean: kWh/m²/year
 */
const GIS = {
  // TODO: replace with your real areas from GIS (km²)
  A_high_km2: 224.978,
  A_mod_km2: 1780.727,

  // Given SR means (kWh/m²/year)
  SR_high_mean: 1406.75546808,
  SR_mod_mean: 1359.54816032
};

/**
 * ===== Fixed assumptions (hidden from user) =====
 */
const FIXED = {
  PR: 0.50,
  BUILDING_KWH_YEAR: 4500,
  GRID_EF_KGCO2_PER_KWH: 0.45,
  ADANA_BUILDING_COUNT: 591936
};

function km2_to_m2(km2){ return km2 * 1_000_000; }
function fmt(x, digits=0){
  return x.toLocaleString(undefined, { maximumFractionDigits: digits });
}
function weightedMeanSR(Ah, Am, SRh, SRm){
  const total = Ah + Am;
  if (!total) return 0;
  return (SRh*Ah + SRm*Am) / total;
}

function calculate(){
  const eff = parseFloat(document.getElementById("tech").value);
  const choice = document.getElementById("classChoice").value;
  const cov = parseFloat(document.getElementById("coverage").value) / 100;

  let area_km2 = 0;
  let sr = 0;

  if (choice === "high"){
    area_km2 = GIS.A_high_km2;
    sr = GIS.SR_high_mean;
  } else if (choice === "mod"){
    area_km2 = GIS.A_mod_km2;
    sr = GIS.SR_mod_mean;
  } else { // high+mod
    area_km2 = GIS.A_high_km2 + GIS.A_mod_km2;
    sr = weightedMeanSR(GIS.A_high_km2, GIS.A_mod_km2, GIS.SR_high_mean, GIS.SR_mod_mean);
  }

  const area_m2 = km2_to_m2(area_km2);
  const used_m2 = area_m2 * cov;

  const energy_kwh = sr * used_m2 * eff * FIXED.PR;

  const buildings_served = energy_kwh / (FIXED.BUILDING_KWH_YEAR || 1);
  const pct_of_adana = (buildings_served / (FIXED.ADANA_BUILDING_COUNT || 1)) * 100;

  const avoided_kg = energy_kwh * FIXED.GRID_EF_KGCO2_PER_KWH;

  document.getElementById("k_area").innerText   = `${fmt(area_km2,2)} km²`;
  document.getElementById("k_used").innerText   = `${fmt(used_m2,0)} m²`;
  document.getElementById("k_sr").innerText     = `${fmt(sr,0)} kWh/m²/year`;
  document.getElementById("k_energy").innerText = `${fmt(energy_kwh,0)} kWh/year`;

  document.getElementById("k_build").innerText  =
    `${fmt(buildings_served,0)} buildings/year (${fmt(pct_of_adana,2)}% of Adana)`;

  document.getElementById("k_co2").innerText    = `${fmt(avoided_kg,0)} kgCO₂/year`;

  document.getElementById("assumptions").innerHTML = `
    PR = <b>${FIXED.PR.toFixed(2)}</b> ·
    Demand proxy = <b>${fmt(FIXED.BUILDING_KWH_YEAR,0)}</b> kWh/building/year ·
    Grid EF = <b>${FIXED.GRID_EF_KGCO2_PER_KWH.toFixed(2)}</b> kgCO₂/kWh ·
    Adana buildings = <b>${fmt(FIXED.ADANA_BUILDING_COUNT,0)}</b>
  `;
}

// Coverage label live
const covEl = document.getElementById("coverage");
const covLabel = document.getElementById("covLabel");
covEl.addEventListener("input", () => {
  covLabel.innerText = covEl.value;
  calculate();
});

// Initial
calculate();
</script>

</body>
</html>
